<!DOCTYPE html>
<html lang="en"><meta charset="utf-8"><meta name="generator" content="Hugo 0.68.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Lua 학습 4일차&nbsp;&ndash;&nbsp;/dev/log</title><link rel="stylesheet" href="/css/core.min.e423c83b21da92bb4e8bb830c9f1f244c55526656580aee89a97a9a3286de39f5329f5710761b5118b808bb4ad342ff6.css" integrity="sha384-5CPIOyHakrtOi7gwyfHyRMVVJmVlgK7ompepoyht459TKfVxB2G1EYuAi7StNC/2"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Lua 학습 4일차" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">/dev/log</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">Categories</a><a class="nav item" href="/tags/">Tags</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Lua 학습 4일차</h1><p class="article date">2020-05-15</p></section><article class="article markdown-body"><h2 id="module">Module</h2>
<p>Lua에서는 여러 모듈로 나누어 프로그램을 관리한다. 모듈을 파일로 존재한다. 사용을 위해 불러오면 하나의 table로 관리된다. 파일은 각각 chunk를 가지고 있다는 것을 이용한다. 기본적으로 두 가지 다른 순서로 모듈을 만들 수 있다.</p>
<h3 id="module-생성">Module 생성</h3>
<h4 id="table을-우선적으로-생성">table을 우선적으로 생성</h4>
<p>첫 번째 방법은 table을 우선 만드는 방법이다. local로 모듈을 담을 table을 만들고 하나씩 추가하는 방법이다.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-- complex.lua</span>
<span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kr">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
	<span class="kr">return</span> <span class="p">{</span> <span class="n">real</span> <span class="o">=</span> <span class="n">r</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imag</span> <span class="o">=</span> <span class="n">i</span> <span class="ow">or</span> <span class="mi">0</span> <span class="p">}</span>
<span class="kr">end</span>

<span class="n">M.i</span> <span class="o">=</span> <span class="n">M.new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="kr">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">M.new</span><span class="p">(</span><span class="n">c1.real</span> <span class="o">+</span> <span class="n">c2.real</span><span class="p">,</span> <span class="n">c1.imag</span> <span class="o">+</span> <span class="n">c2.imag</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">tostring</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">tostring</span><span class="p">(</span><span class="n">c.real</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&#34;+&#34;</span> <span class="o">..</span> <span class="n">tostring</span><span class="p">(</span><span class="n">c.imag</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&#34;i&#34;</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">M</span>
</code></pre></div><h4 id="table을-마지막에-생성">table을 마지막에 생성</h4>
<p>두 번째 방법은 table을 마지막으로 만드는 것이다.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="c1">-- complex.lua</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">new</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
	<span class="kr">return</span> <span class="p">{</span> <span class="n">real</span> <span class="o">=</span> <span class="n">r</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">imag</span> <span class="o">=</span> <span class="n">i</span> <span class="ow">or</span> <span class="mi">0</span> <span class="p">}</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">new</span><span class="p">(</span><span class="n">c1.real</span> <span class="o">+</span> <span class="n">c2.real</span><span class="p">,</span> <span class="n">c1.imag</span> <span class="o">+</span> <span class="n">c2.imag</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">tos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
	<span class="kr">return</span> <span class="n">tostring</span><span class="p">(</span><span class="n">c.real</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&#34;+&#34;</span> <span class="o">..</span> <span class="n">tostring</span><span class="p">(</span><span class="n">c.imag</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&#34;i&#34;</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="p">{</span> <span class="n">new</span> <span class="o">=</span> <span class="n">new</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="n">add</span><span class="p">,</span> <span class="n">tostring</span> <span class="o">=</span> <span class="n">tos</span> <span class="p">}</span>
</code></pre></div><h3 id="module-불러오기">Module 불러오기</h3>
<p><code>require</code>이라는 키워드를 사용하여 module을 불러올 수 있다. table을 반환하기 때문에 적절한 변수에 할당해주어야 한다.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="n">complex</span> <span class="o">=</span> <span class="n">require</span> <span class="s2">&#34;complex&#34;</span>
</code></pre></div><p>모듈은 <code>package.path</code>에서 <code>?</code>위치에 들어갈 수 있는 파일을 찾는 방식이다. <code>.</code>을 이용하여 다른 네임스페이스와 겹치는 것을 방지할 수 있다. <code>dev.log.complex</code>와 같이 적어 'dev/log/complex.lua' 파일을 지정할 수 있다. 검색만 시도해 보는 것은 <code>package.searchpath</code>를 사용하면 된다.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="n">complex</span> <span class="o">=</span> <span class="n">require</span> <span class="s2">&#34;dev.log.complex&#34;</span>

<span class="n">print</span><span class="p">(</span><span class="n">package.searchpath</span><span class="p">(</span><span class="s2">&#34;dev.log.complex&#34;</span><span class="p">,</span> <span class="n">package.path</span><span class="p">))</span>
<span class="cm">--[[
</span><span class="cm">nil
</span><span class="cm">	no file &#39;/usr/local/share/lua/5.3/dev/log/complex.lua&#39;
</span><span class="cm">	...
</span><span class="cm">	no file &#39;./dev/log/complex.lua&#39;
</span><span class="cm">--]]</span>
</code></pre></div><h2 id="metatable">Metatable</h2>
<p>Object-Oriented Programming에서 Class라고 부를만한 것이다. 다른 table의 행동을 변경하는 table이라서 metatable이라고 부른다. arithmetic, relational, concatenation operator를 사용할 수 있게 해준다. C++의 연산자 오버로딩같은 것이다. table을 생성할 때 미리 정의되는 필드를 정할 수 있다. <code>setmetatable</code>과 <code>getmetatable</code>을 이용하여 적용하거나 확인할 수 있다. 이미 어느 table에 적용된 metatable은 수정하지 않는 것을 권장한다.</p>
<p>metatable에는 미리 정의된 metamethod가 19개 존재한다. 모두 언더바(_) 두 개로 시작한다.</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>__add</code></td>
<td align="left"><code>__sub</code></td>
<td align="left"><code>__mul</code></td>
<td align="left"><code>__div</code></td>
<td align="left"><code>__mod</code></td>
</tr>
<tr>
<td align="left"><code>__pow</code></td>
<td align="left"><code>__unm</code></td>
<td align="left"><code>__concat</code></td>
<td align="left"><code>__len</code></td>
<td align="left"><code>__eq</code></td>
</tr>
<tr>
<td align="left"><code>__lt</code></td>
<td align="left"><code>__le</code></td>
<td align="left"><code>__index</code></td>
<td align="left"><code>__newindex</code></td>
<td align="left"><code>__call</code></td>
</tr>
<tr>
<td align="left"><code>__tostring</code></td>
<td align="left"><code>__ipairs</code></td>
<td align="left"><code>__pairs</code></td>
<td align="left"><code>__gc</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>metatable을 module로 만들 수도 있다.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">mt</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">new</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.new</span> <span class="o">=</span> <span class="n">new</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">is_complex</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.is_complex</span> <span class="o">=</span> <span class="n">is_complex</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">add</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.__add</span> <span class="o">=</span> <span class="n">add</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">eq</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.__eq</span> <span class="o">=</span> <span class="n">eq</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">modulus</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.__len</span> <span class="o">=</span> <span class="n">modulus</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">tos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.__tostring</span> <span class="o">=</span> <span class="n">tos</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">le</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="n">mt.__le</span> <span class="o">=</span> <span class="n">le</span>

<span class="kd">local</span> <span class="kr">function</span> <span class="nf">lt</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
	<span class="c1">-- 구현 생략</span>
<span class="kr">end</span>

<span class="kr">return</span> <span class="n">mt</span>
</code></pre></div><h2 id="object">Object</h2>
<p>Lua에서는 직접적으로 Class와 Object를 만드는 문법은 존재하지 않는다. 다만, 메소드를 위한 syntactic-sugar는 존재한다. 메소드의 동작을 위해서는 object 자신을 파라미터로 넘겨주어야 한다. 따라서 다른 언어에서는 주로 암시적으로 넘긴다. Lua에서는 명시적으로도 암시적으로도 구현할 수 있도록 제공한다.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="kr">function</span> <span class="nc">obj</span><span class="p">:</span><span class="nf">method</span><span class="p">(</span><span class="o">&lt;</span><span class="n">other</span> <span class="n">arguments</span><span class="o">&gt;</span><span class="p">)</span>
	<span class="o">&lt;</span><span class="n">code</span> <span class="n">of</span> <span class="n">the</span> <span class="n">method</span><span class="o">&gt;</span>
<span class="kr">end</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="kr">function</span> <span class="nc">obj</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">other</span> <span class="n">arguments</span><span class="o">&gt;</span><span class="p">)</span>
	<span class="o">&lt;</span><span class="n">code</span> <span class="n">of</span> <span class="n">the</span> <span class="n">method</span><span class="o">&gt;</span>
<span class="kr">end</span>
</code></pre></div><p>위 두 코드는 동일하게 동작하는 코드이다. <code>.</code> 대신에 <code>:</code>을 사용하여 함수를 호출함으로써 메소드 호출을 구현한다.</p>
<h2 id="참고">참고</h2>
<p><a href="https://dcc.ufrj.br/~fabiom/lua/09Modules.pdf">https://dcc.ufrj.br/~fabiom/lua/09Modules.pdf</a><br>
<a href="https://dcc.ufrj.br/~fabiom/lua/10Metatables.pdf">https://dcc.ufrj.br/~fabiom/lua/10Metatables.pdf</a><br>
<a href="https://dcc.ufrj.br/~fabiom/lua/11Objects.pdf">https://dcc.ufrj.br/~fabiom/lua/11Objects.pdf</a></p>
</article><section class="article labels"><a class="category" href=/categories/lua/>Lua</a><a class="tag" href=/tags/learn/>Learn</a></section></div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/article/lua/lua-%ED%95%99%EC%8A%B5-5%EC%9D%BC%EC%B0%A8/"><span class="li iconfont icon-article"></span>Lua 학습 5일차</a></p><p><a class="link" href="/article/lua/lua-%ED%95%99%EC%8A%B5-3%EC%9D%BC%EC%B0%A8/"><span class="li iconfont icon-article"></span>Lua 학습 3일차</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">/dev/log</p>
    <p class="powerby"><span>Powered by </span><a href="https://gohugo.io" 
        target="_blank">Hugo</a><span> and the </span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank">Notepadium</a></p>
</div></section><script defer type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-e/4/LvThKH1gwzXhdbY2AsjR3rm7LHWyhIG5C0jiRfn8AN2eTN5ILeztWw0H9jmN" crossorigin="anonymous"></script>
        <script
            type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><script src="/js/hljs.min.0799348a91dce12c6be4a73f943cfe78f181f4e6f6ec35c4af0fca1de377879f77cfab03c30f03a174d675737b5a9314.js" integrity="sha384-B5k0ipHc4Sxr5Kc/lDz&#43;ePGB9Ob27DXErw/KHeN3h593z6sDww8DoXTWdXN7WpMU"></script><script>hljs.initHighlightingOnLoad();</script></body>

</html>